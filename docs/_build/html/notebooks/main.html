<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Project Notebook &#8212; Network Anomaly Detection with BitNet  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Project-Notebook">
<h1>Project Notebook<a class="headerlink" href="#Project-Notebook" title="Link to this heading">¶</a></h1>
<p>Project Topic: Network Anomaly Detection with BitNet Project Description: One of the main problems with machine learning models on a large scale is their resource-intensive nature. This can cause massive spikes in both energy usage and runtime, which is especially problematic in fields such as networking, where latency is of the utmost importance. Our goal with this project is to transfer the principles of BitNet, a recent model which does away with resource-intensive matrix multiplications via
the quantization of weights, to a networking context. Specifically, we will build a simple regression model with this method, which we will then use on a dataset of packet traces during which several intrusions were attempted.</p>
<p>Collaborators: Alexander Baumgartner, Alexander Williams, Alejandro Alonso</p>
<p>Professor: Nick Feamster</p>
<hr class="docutils" />
<section id="Packages">
<h2>Packages<a class="headerlink" href="#Packages" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pip</span> install matplotlib scikit-learn pandas numpy scipy torch tqdm joblib pathlib psutil pyRapl
</pre></div>
</div>
</div>
</section>
<section id="Imports">
<h2>Imports<a class="headerlink" href="#Imports" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplolib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">auc</span>

<span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
hello world
</pre></div></div>
</div>
</section>
<section id="pyRapl">
<h2>pyRapl<a class="headerlink" href="#pyRapl" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyRAPL</span>
    <span class="n">PYRAPL_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">PYRAPL_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</section>
<section id="Data-Processor">
<h2>Data Processor<a class="headerlink" href="#Data-Processor" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>

<span class="c1"># Implementation of the data processing class and integration function continues...</span>
<span class="k">class</span> <span class="nc">MemoryEfficientIDSDataProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Improved data processor with better preprocessing and memory management.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>  <span class="c1"># Changed to RobustScaler for better handling of outliers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attack_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;BENIGN&#39;</span><span class="p">:</span> <span class="s1">&#39;Benign&#39;</span><span class="p">,</span>
            <span class="s1">&#39;FTP-Patator&#39;</span><span class="p">:</span> <span class="s1">&#39;Brute Force&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SSH-Patator&#39;</span><span class="p">:</span> <span class="s1">&#39;Brute Force&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DoS GoldenEye&#39;</span><span class="p">:</span> <span class="s1">&#39;DoS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DoS Hulk&#39;</span><span class="p">:</span> <span class="s1">&#39;DoS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DoS Slowhttptest&#39;</span><span class="p">:</span> <span class="s1">&#39;DoS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DoS slowloris&#39;</span><span class="p">:</span> <span class="s1">&#39;DoS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Heartbleed&#39;</span><span class="p">:</span> <span class="s1">&#39;Heartbleed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Web Attack - Brute Force&#39;</span><span class="p">:</span> <span class="s1">&#39;Web Attack&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Web Attack - Sql Injection&#39;</span><span class="p">:</span> <span class="s1">&#39;Web Attack&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Web Attack - SQL Injection&#39;</span><span class="p">:</span> <span class="s1">&#39;Web Attack&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Web Attack - XSS&#39;</span><span class="p">:</span> <span class="s1">&#39;Web Attack&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Infiltration&#39;</span><span class="p">:</span> <span class="s1">&#39;Infiltration&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Bot&#39;</span><span class="p">:</span> <span class="s1">&#39;Bot&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PortScan&#39;</span><span class="p">:</span> <span class="s1">&#39;PortScan&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DDoS&#39;</span><span class="p">:</span> <span class="s1">&#39;DDoS&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">preprocess_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocess a single chunk of data with improved cleaning.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make a copy to avoid modifying the original</span>
        <span class="n">processed_chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Get numeric columns, excluding &#39;Label&#39; if it exists</span>
        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;Label&#39;</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="n">numeric_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Label&#39;</span><span class="p">)</span>

        <span class="c1"># Handle numeric columns only</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Replace inf values</span>
                <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

                <span class="c1"># Calculate outlier bounds</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
                <span class="n">q3</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
                <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
                <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">iqr</span>
                <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">iqr</span>

                <span class="c1"># Clip outliers</span>
                <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

                <span class="c1"># Handle skewness only if the column has no NaN values</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">skewness</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">skewness</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Ensure all values are positive before log transform</span>
                        <span class="n">min_val</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">min_val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_val</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">processed_chunk</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Error processing column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># If there&#39;s an error processing the column, keep it as is</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">processed_chunk</span>

    <span class="k">def</span> <span class="nf">process_file_in_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process file in chunks with improved error handling and monitoring.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_rows</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">corrupted_rows</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Read CSV in chunks</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Track original row count</span>
                    <span class="n">chunk_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="n">total_rows</span> <span class="o">+=</span> <span class="n">chunk_rows</span>

                    <span class="c1"># Basic cleaning</span>
                    <span class="n">chunk</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                    <span class="c1"># Preprocess chunk</span>
                    <span class="n">cleaned_chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">cleaned_chunk</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleaned_chunk</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">corrupted_rows</span> <span class="o">+=</span> <span class="n">chunk_rows</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Error processing chunk: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">corrupted_rows</span> <span class="o">+=</span> <span class="n">chunk_rows</span>

                <span class="c1"># Force garbage collection</span>
                <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Report statistics</span>
        <span class="k">if</span> <span class="n">total_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="n">total_rows</span><span class="si">}</span><span class="s2"> total rows&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">corrupted_rows</span><span class="si">}</span><span class="s2"> corrupted rows (</span><span class="si">{</span><span class="p">(</span><span class="n">corrupted_rows</span><span class="o">/</span><span class="n">total_rows</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">chunks</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_and_preprocess_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load and preprocess data with improved monitoring and validation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_samples</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">attack_distribution</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Process only Tuesday&#39;s data first</span>
        <span class="n">tuesday_file</span> <span class="o">=</span> <span class="s2">&quot;Tuesday-WorkingHours.pcap_ISCX.csv&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">tuesday_file</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">tuesday_file</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing </span><span class="si">{</span><span class="n">tuesday_file</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_file_in_chunks</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Track attack distribution</span>
            <span class="k">if</span> <span class="s1">&#39;Label&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">attack_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">attack</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">attack_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">attack_distribution</span><span class="p">[</span><span class="n">attack</span><span class="p">]</span> <span class="o">=</span> <span class="n">attack_distribution</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span>
                <span class="n">total_samples</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="c1"># Print data statistics</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Statistics:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total samples: </span><span class="si">{</span><span class="n">total_samples</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Attack distribution:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attack</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">attack_distribution</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="o">/</span><span class="n">total_samples</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attack</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> samples (</span><span class="si">{</span><span class="n">percentage</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

        <span class="c1"># Combine processed data (just Tuesday in this case)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Combining processed data...&quot;</span><span class="p">)</span>
        <span class="n">full_data</span> <span class="o">=</span> <span class="n">processed_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Take only Tuesday&#39;s data</span>
        <span class="k">del</span> <span class="n">processed_data</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">full_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data was successfully processed&quot;</span><span class="p">)</span>

        <span class="c1"># Encode labels</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Encoding labels...&quot;</span><span class="p">)</span>
        <span class="n">full_data</span><span class="p">[</span><span class="s1">&#39;Attack_Category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[</span><span class="s1">&#39;Label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attack_mapping</span><span class="p">)</span>
        <span class="n">full_data</span><span class="p">[</span><span class="s1">&#39;Attack_Category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[</span><span class="s1">&#39;Attack_Category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="n">full_data</span><span class="p">[</span><span class="s1">&#39;Label_Binary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">full_data</span><span class="p">[</span><span class="s1">&#39;Attack_Category&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Benign&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Select features</span>
        <span class="n">feature_columns</span> <span class="o">=</span> <span class="n">full_data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">feature_columns</span> <span class="o">=</span> <span class="n">feature_columns</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Label_Binary&#39;</span><span class="p">])</span>

        <span class="c1"># Extract features and handle NaN values</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handling missing values in features...&quot;</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[</span><span class="n">feature_columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Fill NaN values with column medians</span>
        <span class="k">for</span> <span class="n">col_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">col_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">col_idx</span><span class="p">])</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">col_idx</span><span class="p">])</span>
            <span class="n">X</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_median</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[</span><span class="s1">&#39;Label_Binary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># Verify no NaN values remain</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(),</span> <span class="s2">&quot;NaN values remain after median filling&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(),</span> <span class="s2">&quot;NaN values found in labels&quot;</span>

        <span class="c1"># Store feature statistics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="n">feature_columns</span><span class="p">,</span>
            <span class="s1">&#39;means&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;stds&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;mins&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;maxs&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final dataset shape: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class distribution: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">feature_columns</span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Network Anomaly Detection with BitNet</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pages/ids_processor.html">IDS Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/efficient_ids.html">Our Model (MatMul-Free Efficient IDS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/standard_ids.html">Standard IDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pages/ids_data_processor.html">IDS Processor</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alexander Baumgartner, Alexander Williams, Alejandro Alonso.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/notebooks/main.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>